# ゴルフレッスン予約 要件定義

## 1. 概要

毎月の予約開放日に、指定条件に合う日付を自動で予約サイト上で押さえる仕組みを目指す。

## 2. 要件一覧

| # | 要件 | 種別 | 備考 |
|---|------|------|------|
| R1 | 毎月23日22時から翌月分の予約が可能になる | 業務ルール | 予約開放日時 |
| R2 | 予約は月に2枠まで可能 | 業務ルール | サイト側の制約 |
| R3 | 予約対象サイト: https://appy-epark.com/users/mypage/reservation/calendar.php | 前提 | ePark系（appy） |
| R4 | 毎月「予約したい条件」を指定し、その条件に合う日付をブラウザ操作で予約する | 機能 | 条件指定＋自動予約 |
| R5 | 条件の指定方法を決める。かつ忘れないようにしたい | 非機能 | 運用・リマインダー |
| R6 | 予約枠的に可能なら「中1週」は空ける（避ける） | 希望条件 | 月初・月末週を優先 |
| R7 | 実行は GAS または GitHub Actions。起動時に Slack 等で通知する | 非機能 | 実行環境・通知 |
| R8 | その月の予約開始日時が違う場合に対応できるよう、開始日時もインプットできるようにする | 機能 | 変動対応 |

## 3. 要件の詳細

### R1: 予約開放日時

- **いつ**: 毎月23日 22:00
- **何が**: 翌月分の予約が可能になる
- **例**: 1月23日22時 → 2月分の予約が可能

### R2: 予約枠数

- 1か月あたり **2枠** まで予約可能（サイトの仕様）

### R3: 予約サイト

- URL: https://appy-epark.com/users/mypage/reservation/calendar.php
- マイページの予約カレンダーであるため **ログイン必須** と想定

### R4: 条件に合う日付の自動予約

- **入力**: ユーザーが「今月（または対象月）に予約したい条件」を指定
- **処理**: その条件に当てはまる日付をブラウザ操作で予約する
- **手段**: ブラウザ自動操作（例: Puppeteer / Playwright / Selenium、またはGAS＋ブラウザ連携など）

### R5: 条件の指定方法と忘れないようにする

- **指定方法**（確定）:
  - 設定ファイル or スプレッドシートで管理（推奨の方法でよい）
  - **可能な日付**と**時間帯**を入力する。時間帯は **「17時〜18時」** のように記載する。
- **忘れないようにする**:
  - **毎月 Slack 等でリマインダーを送り、そのタイミングでユーザーがどこか（スプレッドシート・フォーム等）に入力する**運用とする。

### R6: 中1週を空ける（希望）

- **意味**: 月の「真ん中1週間」は極力予約しない（月初週・月末週を優先）
- **前提**: 予約枠の空き状況的に可能な場合のみ。空きがなければ他の週でも予約する

## 4. 用語

- **中1週**: 月を3分割したときの「真ん中の約1週間」（例: 2月ならおおよそ8日〜14日付近）
- **予約開放**: 毎月23日22時以降、翌月分の予約が可能になること

## 5. 追加要件（運用・入力）

### R7: 実行環境と通知

- **実行環境**: 可能なら **GAS（Google Apps Script）** または **GitHub Actions** で動かす。
- **起動通知**: スクリプトが起動したら **Slack 等で「予約スクリプトを実行しました」と通知する**。

### R8: 予約開始日時の変動対応

- **背景**: その月だけ予約開始日時が違う（例: 23日22時ではなく24日10時など）ことがあり得る。
- **要件**: 予約可能条件をインプットするときに、**「その月の予約可能開始日時」**（いつから予約が開放されるか）も入力できるようにする。
- **例**: 通常は「23日 22:00」、今月だけ「24日 10:00」など。未入力の場合はデフォルト（23日22時）とする。

---

## 6. インプット仕様（条件・開始日時）

ツールが毎月受け取る入力は以下を想定する。

| 項目 | 内容 | 例 |
|------|------|-----|
| 可能な日付 | 予約したい日付の条件（週・曜日・日付範囲等） | 第1週・最終週、土日のみ など |
| 時間帯 | 希望する時間帯。「〇時〜〇時」形式で記載 | 17時〜18時、9時〜12時 など |
| 予約開始日時（任意） | その月の予約開放日時。未入力時は 23日22時 | 24日 10:00（今月だけ違う場合） |

- 入力手段: スプレッドシート or 設定ファイル。毎月 Slack リマインダー後にユーザーが入力する。

---

## 7. 今後の検討事項

- 条件の具体的なフォーマット（日付範囲・「17時〜18時」の複数指定など）
- 認証情報の安全な保持方法（環境変数、シークレット管理）
- 予約実行のタイミング（開始時刻ちょうどに実行するか、数分後か）
