# 予約スクリプトのフロー

## 1. 実行の流れ（1件目・2件目）

はい、次の順番になっています。

1. **カレンダー**（各種50分枠レッスン）を表示
2. **1件目**: ○ をクリック → **予約詳細画面** → ペアレッスンにチェック → 「予約する」→ **モーダル**「この内容で予約しますか？」→ **#modal-content_ok** で確定
3. 予約完了後、**空枠確認に戻る**（「空枠確認・予約する」クリック or マイページから）
4. **各種50分枠レッスン** を再度クリック → **カレンダー**を再表示
5. **2件目**: ○ をクリック → **予約詳細画面** → ペアレッスンにチェック → 「予約する」→ **モーダル** → **#modal-content_ok** で確定

つまり「カレンダー → 予約画面（詳細）→ モーダルで確定」を 1 件目で行い、一度カレンダーに戻ってから、同じ流れで 2 件目を取る形です。

## 2. 1件目と2件目の間隔（月内で均等に）

はい、対応しています。

- **意図**: 1ヶ月に2回レッスンを受けられるので、できるだけ**均等な間隔**で受けられるようにする。
- **設定**: `config.yaml` の `minDaysBetweenSlots`（既定値: 7）で、1件目と2件目の**最小間隔（日数）**を指定します。
- **動作**:
  1. 1件目: 条件に合う ○ を**すべて候補として集め**、**土日祝 > 平日**の優先でソートしてから1件を選んで予約する。
  2. 2件目: 条件に合い、かつ1件目から `minDaysBetweenSlots` 日以上空いている ○ を**すべて候補として集める**。候補のうち、**土日祝を優先**し、そのうえで「1件目の日付 + 半月」にいちばん近い日を選び、その枠だけを予約する。

これで、1回目と2回目は**1週間以上空きつつ、月内でできるだけ均等な間隔**になります。
